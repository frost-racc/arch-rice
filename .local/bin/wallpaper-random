#!/bin/bash

# Set your wallpapers directory
WALLPAPER_DIR="$HOME/.config/wallpapers/img/"

# Pick a random image
IMAGE=$(find "$WALLPAPER_DIR" -type f \( -iname '*.jpg' -o -iname '*.png' -o -iname '*.jpeg' \) | shuf -n 1)

# Check if an image was found
if [[ -z "$IMAGE" ]]; then
    fyi "No image found in $WALLPAPER_DIR"
    exit 1
fi

# Call programs

# swww background 


# Wait for swww-daemon
until swww query >/dev/null 2>&1; do
    sleep 0.5
    fyi "swww-daemon not responding"
done

echo "swww-daemon up and running ----------"
swww img "$IMAGE" -t any --transition-duration=1.5
fyi "Changed wallpaper to "$IMAGE""

# wal without setting wallpaper '-n'
sleep 0.5
wal --cols16 -i "$IMAGE" -n
fyi "Generated/applied color scheme"

# spf config
cp $HOME/.cache/wal/colors-superfile.toml $HOME/.config/superfile/theme/

# cava config
cp $HOME/.cache/wal/colors-cava $HOME/.config/cava/themes/

# spicetify
cp $HOME/.cache/wal/colors-spicetify.ini $HOME/.config/spicetify/Themes/wal/color.ini
fyi Superfile, spf, spicetify theme exported!

# set spicetify theme
$HOME/.spicetify/spicetify config current_theme wal
$HOME/.spicetify/spicetify config color_scheme wal
$HOME/.spicetify/spicetify apply --no-restart
# --- Relaunch Spotify only if it was open before ---
if pgrep -x spotify >/dev/null; then
    echo "Spotify was running — relaunching after theme update..."
    pkill -x spotify  # close Spotify cleanly
    sleep 1
    hyprctl dispatch exec spotify
else
    echo "Spotify not running — leaving it closed."
fi

